# ☕ Walkthrough LAMP

#### Guía paso a paso para crear un servidor LAMP

```bash
ssh root@ip_address
adduser dcollao
usermod -aG sudo dcollao #agregamos sudo a nuestro usuario recién creado
#configuramos de forma básica nuestro firewall
ufw app list
```

> ```
> OutputAvailable applications:
>   OpenSSH
> ```

```bash
ufw allow OpenSSH #permitimos conecciones SSH
#activamos el firewall
ufw enable #type yes
#Firewall is active and enabled on system startup
ufw status
exit
```

<pre class="language-bash"><code class="lang-bash">ssh username@ip_address
sudo apt update
sudo apt install apache2
#Adjust the Firewall to Allow Web Traffic
sudo ufw app list
#Ver Apache Full profile details
sudo ufw app info "Apache Full"
#To allow incoming HTTP and HTTPS traffic for this server, run:
sudo ufw allow "Apache Full"
#Rule added Rule added (v6)
#Puedes revisar http://your_server_ip
#Para saber la IP de tu servidor puedes correr el siguiente script
ip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\/.*$//'
<strong>#También puedes usar el método con CURL
</strong><strong>sudo apt install curl
</strong>curl http://imura.cl</code></pre>

#### Instalar y configurar MySQL

{% code overflow="wrap" %}
```bash
sudo apt install mysql-server
#Comprobamos que el servicio se encuentra corriendo
sudo systemctl start mysql.service
sudo mysql
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
mysql_secure_installation #Después que termine de correr el script iniciamos mysql como root
mysql -u root -p 
#Revisamos como va nuestro servicio MYSQL
systemctl status mysql.service
```
{% endcode %}

#### Instalar y configurar PhpMyAdmin

<pre class="language-bash"><code class="lang-bash">mysql -u root -p
UNINSTALL COMPONENT "file://component_validate_password";
exit
sudo apt install phpmyadmin php-mbstring php-zip php-gd php-json php-curl
<strong>sudo phpenmod mbstring
</strong>sudo systemctl restart apache2
mysql -u root -p
CREATE USER 'dcollao'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
SELECT user,authentication_string,plugin,host FROM mysql.user;
GRANT ALL PRIVILEGES ON *.* TO 'dcollao'@'localhost' WITH GRANT OPTION;
INSTALL COMPONENT "file://component_validate_password";
exit
sudo apt-get install libapache2-mod-php
<strong>sudo nano /etc/apache2/apache2.conf
</strong><strong>#Agregar Include /etc/phpmyadmin/apache.conf
</strong><strong>#http://ip_address/phpmyadmin/ root &#x26; password
</strong>sudo nano /etc/apache2/conf-available/phpmyadmin.conf
#Agregar AllowOverride All
sudo systemctl restart apache2
#Creamos un archivo .htaccess
sudo nano /usr/share/phpmyadmin/.htaccess
#Agregamos lo siguiente:
AuthType Basic
AuthName "Restricted Files"
AuthUserFile /etc/phpmyadmin/.htpasswd
Require valid-user
sudo htpasswd -c /etc/phpmyadmin/.htpasswd dcollao
sudo systemctl restart apache2</code></pre>

#### Instalar PHP

<pre class="language-bash"><code class="lang-bash">sudo apt install php libapache2-mod-php php-mysql
sudo mkdir /var/www/imura.cl
sudo chown -R $USER:$USER /var/www/imura.cl
sudo chmod -R 755 /var/www
sudo nano /etc/apache2/sites-available/imura.cl.conf
#Agregamos lo siguiente
<strong>&#x3C;VirtualHost *:80>
</strong>    ServerName imura.cl
    ServerAlias www.imura.cl 
    ServerAdmin webmaster@imura.cl
    DocumentRoot /var/www/imura.cl/
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
&#x3C;/VirtualHost>
sudo a2ensite imura.cl
sudo a2dissite 000-default
sudo apache2ctl configtest
sudo systemctl reload apache2
sudo nano /var/www/imura.cl/index.html
#Agregamos lo siguiente
&#x3C;html>
  &#x3C;head>
    &#x3C;title>imura.cl website&#x3C;/title>
  &#x3C;/head>
  &#x3C;body>
    &#x3C;h1>Hello World!&#x3C;/h1>

    &#x3C;p>This is the landing page of &#x3C;strong>imura.cl&#x3C;/strong>.&#x3C;/p>
  &#x3C;/body>
&#x3C;/html>
#Cambiamos el orden de lectura de extensiones 
#PHP primero
sudo nano /etc/apache2/mods-enabled/dir.conf
sudo systemctl reload apache2
sudo nano /var/www/imura.cl/info.php
#Agregamos lo siguiente
&#x3C;?php
phpinfo();</code></pre>

#### Configurar SSL

```bash
sudo apt install certbot python3-certbot-apache
sudo apache2ctl configtest
sudo systemctl reload apache2
sudo certbot --apache
sudo systemctl status certbot.timer
sudo certbot renew --dry-run

```

#### Preparando nuestro servidor para Wordpress

```bash
mysql -u root -p
CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;
UNINSTALL COMPONENT "file://component_validate_password";
CREATE USER 'dcollao'@'%' IDENTIFIED WITH mysql_native_password BY 'password';
GRANT ALL ON wordpress.* TO 'dcollao'@'%';
FLUSH PRIVILEGES;
INSTALL COMPONENT "file://component_validate_password";
exit
#Instalando extensiones necesarias para Wordpress
sudo apt update
sudo apt install php-curl php-gd php-mbstring php-xml php-xmlrpc php-soap php-intl php-zip
sudo systemctl restart apache2
sudo nano /etc/apache2/sites-available/imura.cl.conf
#Agregamos lo siguiente en nuestro .conf
<Directory /var/www/imura.cl/>
	AllowOverride All
</Directory>
sudo a2enmod rewrite
sudo apache2ctl configtest
#Para sacar el mensaje de error modificamos nuestro /etc/apache2/apache2.conf.
#Agregamos ServerName domain-name (imura.cl en este caso)
#Luego vamos a nuestro /etc/apache2/apache2.conf y comentamos
#Include /etc/phpmyadmin/apache.conf
sudo systemctl restart apache2
```

#### Descargando la última versión de Wordpress

```bash
cd /tmp
curl -O https://wordpress.org/latest.tar.gz
tar xzvf latest.tar.gz
#Creamos un .htaccess que utilizaremos más adelante
touch /tmp/wordpress/.htaccess
#Copiamos la configuración de ejemplo como la configuración que utilizaremos
cp /tmp/wordpress/wp-config-sample.php /tmp/wordpress/wp-config.php
#We can also create the upgrade directory, so that WordPress won’t run into permissions issues when trying to do this on its own following an update to its software:
mkdir /tmp/wordpress/wp-content/upgrade
#Ahora Copiamos todos los archivos de nuestro Wordpress
sudo cp -a /tmp/wordpress/. /var/www/imura.cl/
#Adjusting the Ownership and Permissions
sudo chown -R www-data:www-data /var/www/imura.cl
sudo find /var/www/imura.cl/ -type d -exec chmod 750 {} \;
sudo find /var/www/imura.cl/ -type f -exec chmod 640 {} \;
curl -s https://api.wordpress.org/secret-key/1.1/salt/
sudo nano /var/www/imura.cl/wp-config.php
#Copiamos y cambiamos los hash que recibimos anteriormente
#Modificamos el DB_NAME, DB_USER, DB_PASSWORD
#Continuamos instalando desde la pagina web

```

#### Otras configuraciones

{% code overflow="wrap" %}
```bash
#Si tenemos problemas al subir un theme o algún plugin, esto debe ser por el upload_max_filesize
php -i | grep php.ini
sudo systemctl restart apache2
sudo service apache2 restart
```
{% endcode %}
